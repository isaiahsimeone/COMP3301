#include <sys/ioctl.h>

#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <errno.h>
#include <err.h>
#include <time.h>
#include <poll.h>

/*
 * Developed to test the /dev/acct in FIONREAD mode
 * via ioctl()
 *
 * Runs until signaled, reading the amount of available
 * data that can be read from /dev/acct
 *
 * Produces expected result: Prints the total size of the
 * queue of messages that are ready for reading
 *
 * No args.
 */
int main(int argc, char** argv)
{
	int p = 0;
	int fd = open("/dev/acct", O_RDONLY);
	
	for (;;) {
		if (ioctl(fd, FIONREAD, &p) == -1)
			err(1, "ioctl");
		printf("%d bytes available\n", p);	
		sleep(1);
	}

	return (0);
}